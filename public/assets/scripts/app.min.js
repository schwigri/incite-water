"use strict";var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var config={apiKey:"AIzaSyD6jtPfG6lJLRzBwZsKWfDTuQj54p6cmVw",authDomain:"water-project-da557.firebaseapp.com",databaseURL:"https://water-project-da557.firebaseio.com",projectId:"water-project-da557",storageBucket:"water-project-da557.appspot.com",messagingSenderId:"858447631180"};firebase.initializeApp(config);var db=firebase.firestore(),rt=firebase.database(),Calculator=function(){function a(b){_classCallCheck(this,a),this.utilities={waterStorage:[{name:"RTS Black with Spiggot",cost:200},{name:"Gcube IBC Tank",cost:500},{name:"Bushman 530",cost:1170},{name:"Norwesco 1000",cost:1500}],washingmachine:[{name:"Magic Chef Compact Top Load Washer",cost:241},{name:"Amana Top Load Washer",cost:400},{name:"Whirlpool High-Efficiency Top Load Washer",cost:700}]},b&&(this.data=b),this.data.averageRain=0.26*(365*(window.averageRain/12)),this.data.maxRain=0.26*(30*window.maxRain),this.data.waterPrice=window.waterPrice/748}return _createClass(a,[{key:"calculate",value:function calculate(){var b={waterSavings:0,dollarSavings:0,cost:0,brands:{},credits:0,creditPotential:0,paybackMonths:0,creditPaybackMonths:0,bottles:0};if(0<this.data.space){var c=0,d=0.7*(this.data.maxRain*this.data.householdSize),f=150*this.data.space,g=Math.min(d,f);150>(0<g)?(c=this.utilities.waterStorage[0].cost,b.brands.waterStorage=this.utilities.waterStorage[0].name):300>(150<=g)?(c=this.utilities.waterStorage[1].cost,b.brands.waterStorage=this.utilities.waterStorage[1].name):450>(300<=g)?(c=this.utilities.waterStorage[2].cost,b.brands.waterStorage=this.utilities.waterStorage[2].name):(c=this.utilities.waterStorage[3].cost,b.brands.waterStorage=this.utilities.waterStorage[3].name),b.cost+=c,b.waterSavings+=12*g,b.dollarSavings+=12*(g*this.data.waterPrice)}if(this.data.toilet){var h=365*(0.2*(26.7*this.data.householdSize)),j=213;this.data.diy||(j+=173),b.cost+=j,b.waterSavings+=h,b.dollarSavings+=h*this.data.waterPrice}if(this.data.dishwasher){var k=52*(5*Math.min(this.data.householdSize,7)),l=499;this.data.diy||(l+=109),b.cost+=l,b.waterSavings+=k,b.dollarSavings+=k*this.data.waterPrice}if("new"!==this.data.washingmachine){var m=0,n="",o=27;"old"!==this.data.washingmachine&&(o=12);var q=52*o*Math.min(1.5*this.data.householdSize,7);2>=this.data.householdSize?(m=this.utilities.washingmachine[0].cost,n=this.utilities.washingmachine[0].name):4>=(3<=this.data.householdSize)?(m=this.utilities.washingmachine[1].cost,n=this.utilities.washingmachine[1].name):(m=this.utilities.washingmachine[2].cost,n=this.utilities.washingmachine[2].name),b.cost+=m,b.waterSavings+=q,b.dollarSavings+=q*this.data.waterPrice,b.brands.washingmachine=n}if(this.data.showerheadsLowFlow){console.log("can get new showerheads");var r=365*(1*8.2*this.data.householdSize);b.cost+=20,b.waterSavings+=r,b.dollarSavings+=r*this.data.waterPrice}if(this.data.garden){console.log("yay garden!");var t=1560*Math.min(1.5*this.data.householdSize,7)+365*(1.5*8.2*this.data.householdSize),u=500;this.data.diy||(u+=2598),b.cost+=u,b.waterSavings+=t,b.dollarSavings+=t*this.data.waterPrice}return b.credits=b.waterSavings/1e3,b.creditPotential=9*b.credits,b.paybackMonths=b.cost/b.dollarSavings,b.creditPaybackMonths=b.cost/(b.dollarSavings+b.creditPotential),b.bottles=7.57*b.waterSavings,b}}]),a}(),Application=function(){function a(){_classCallCheck(this,a),this.pages=document.querySelectorAll(".page"),this.pageIndicatorContainer=document.getElementById("pages-pagination"),this.pageIndicators=document.querySelectorAll(".page-indicator");var b=this;this.inputs={householdSize:document.getElementById("household-size"),roofSize:document.getElementById("roof-size"),spaceAvailable:document.getElementById("space-available"),openToDiy:document.getElementById("open-to-diy"),toiletAge:document.getElementById("toilet-age"),dishwasherAge:document.getElementById("dishwasher-age"),washingMachineAge:document.getElementById("washing-machine-age"),showerheads:document.getElementById("showerheads-low-flow"),garden:document.getElementById("garden")};var c=document.querySelectorAll(".page button.continue"),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var j,_loop=function(){var m=j.value;m.addEventListener("click",function(n){if(n.preventDefault(),!1==m.disabled){var o=parseInt(m.parentNode.parentNode.dataset.page);b.showPage("calculator-page-"+(o+1))}})},h=c[Symbol.iterator]();!(_iteratorNormalCompletion=(j=h.next()).done);_iteratorNormalCompletion=!0)_loop()}catch(m){_didIteratorError=!0,_iteratorError=m}finally{try{!_iteratorNormalCompletion&&h.return&&h.return()}finally{if(_didIteratorError)throw _iteratorError}}var d=document.querySelectorAll(".page button.back-button"),_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var l,_loop2=function(){var m=l.value;m.addEventListener("click",function(n){if(n.preventDefault(),!1==m.disabled){var o=m.dataset.target;b.showPage("calculator-page-"+o)}})},k=d[Symbol.iterator]();!(_iteratorNormalCompletion2=(l=k.next()).done);_iteratorNormalCompletion2=!0)_loop2()}catch(m){_didIteratorError2=!0,_iteratorError2=m}finally{try{!_iteratorNormalCompletion2&&k.return&&k.return()}finally{if(_didIteratorError2)throw _iteratorError2}}var f=this.inputs,g=document.getElementById("p3done-button");g.addEventListener("click",function(m){m.preventDefault();var n={space:parseInt(f.spaceAvailable.value),householdSize:parseInt(f.householdSize.value),diy:"true"==f.openToDiy.value,dishwasher:"old"==f.dishwasherAge.value,washingmachine:f.washingMachineAge.value,showerheadsLowFlow:"no"==f.showerheads.value||"maybe"==f.showerheads.value,garden:"flowers"==f.garden.value},o=new Calculator(n),q=o.calculate(),r=(""+q.dollarSavings).split("."),s=(""+q.waterSavings).split(".");s=s[1]?s[0]+"."+s[1].substring(0,2):s[0],r=r[1]?r[0]+"."+r[1].substring(0,2):r[0],document.getElementById("water-savings").innerHTML=s,document.getElementById("dollar-savings").innerHTML=r,document.getElementById("cost").innerHTML=q.cost,document.getElementById("credits").innerHTML=q.credits.toFixed(2),document.getElementById("credits-potential").innerHTML=q.creditPotential.toFixed(2),document.getElementById("payback-months").innerHTML=q.paybackMonths.toFixed(2),document.getElementById("credits-payback").innerHTML=q.creditPaybackMonths.toFixed(2),document.getElementById("bottles-saved").innerHTML=q.bottles.toFixed(2);var t="dashboard.html";t+="?d="+r,t+="&g="+s,t+="&c="+q.cost,t+="&p="+q.paybackMonths.toFixed(2),t+="&cr="+q.credits.toFixed(2),t+="&cv="+q.creditPotential.toFixed(2),t+="&sp="+q.creditPaybackMonths.toFixed(2),document.getElementById("dashboard").src=t,b.showPage("calculator-page-4")}),this.checkPages(this.inputs)}return _createClass(a,[{key:"checkPages",value:function checkPages(b){(function c(){var d=document.getElementById("p1done-button"),f=/^[0-9]+$/;b.roofSize.addEventListener("input",function(){var g=b.roofSize.value;d.disabled=""!=g&&g.match(f)?!1:!0})})()}},{key:"showPage",value:function showPage(b){var c=this,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var f,g,d=this.pages[Symbol.iterator]();!(_iteratorNormalCompletion3=(f=d.next()).done);_iteratorNormalCompletion3=!0)g=f.value,g.classList.remove("current")}catch(h){_didIteratorError3=!0,_iteratorError3=h}finally{try{!_iteratorNormalCompletion3&&d.return&&d.return()}finally{if(_didIteratorError3)throw _iteratorError3}}window.setTimeout(function(){var h=document.getElementById(b);if(h.dataset.page){var j=parseInt(h.dataset.page);if(4>j){c.pageIndicatorContainer.classList.add("visible");var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var n,o,m=c.pageIndicators[Symbol.iterator]();!(_iteratorNormalCompletion4=(n=m.next()).done);_iteratorNormalCompletion4=!0)o=n.value,o.classList.remove("filled")}catch(q){_didIteratorError4=!0,_iteratorError4=q}finally{try{!_iteratorNormalCompletion4&&m.return&&m.return()}finally{if(_didIteratorError4)throw _iteratorError4}}for(var l,k=0;k<j;k++)l=c.pageIndicators[k],l.classList.add("filled")}else document.getElementById("pages-pagination").style.visibility="hidden"}else c.pageIndicatorContainer.classList.remove("visible");h.classList.add("current")},500)}}]),a}(),application=new Application,theURL=new URL(window.location.href),theZipCode=theURL.searchParams.get("zip");theZipCode&&5===theZipCode.length?rt.ref("/zipcodes/"+theZipCode).once("value").then(function(a){console.log(a.val()),window.averageRain=a.val().averageRain,window.maxRain=a.val().maxRain,window.zipcode=theZipCode,window.waterPrice=a.val().waterPrice?a.val().waterPrice:0,application.showPage("calculator-page-1")}):window.location.href="/sign-up/";